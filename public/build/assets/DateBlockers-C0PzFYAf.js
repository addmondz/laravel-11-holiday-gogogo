import{r as y,i as V,C as I,k as Z,g as u,o as i,b as t,a as S,h as f,t as m,F as P,y as U,c as ee,w as O,f as te,e as $,j as _,n as b,u as s,q as k,x as oe,z as M}from"./app-C1-YVJKV.js";import{_ as L}from"./Modal.vue_vue_type_script_setup_true_lang-Bt2XXqqV.js";import{P as re}from"./Pagination-tDCmOMnC.js";import{h}from"./moment-C5S46NFB.js";import{S as g}from"./sweetalert2.esm.all-B0Dix5B2.js";import{L as se}from"./LoadingComponent-BISFBWVe.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"space-y-6"},ne={class:"flex justify-between items-center"},le={class:"flex items-center space-x-4"},ie={class:"overflow-x-auto"},ue={key:0,class:"flex justify-center items-center h-full min-h-[400px]"},ce={key:1,class:"min-w-full divide-y divide-gray-200"},pe={class:"bg-gray-50"},me={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12"},ge=["checked","indeterminate"],fe={class:"bg-white divide-y divide-gray-200"},xe={class:"px-6 py-4 whitespace-nowrap"},ye=["checked","onChange"],ve={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ke={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},he=["onClick"],we=["onClick"],Ce={key:0},Be={class:"mt-4"},De={class:"p-6"},Ee={key:0,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded relative"},Ae={class:"grid grid-cols-1 gap-6"},Se={key:0,class:"mt-1 text-sm text-red-600"},Me={key:0,class:"mt-1 text-sm text-red-600"},Ye=["value"],je={class:"mt-6 flex justify-end space-x-3"},Fe=["disabled"],Te={class:"p-6"},qe={class:"grid grid-cols-1 gap-6"},Ve={key:0,class:"mt-1 text-sm text-red-600"},Ie={key:0,class:"mt-1 text-sm text-red-600"},Pe={class:"mt-6 flex justify-end space-x-3"},Ue=["disabled"],Oe={__name:"DateBlockers",props:{packageId:{type:Number,required:!0},package:{type:Object,required:!0},packageUniqueRoomTypes:{type:Object,required:!0}},setup(Y){const w=Y,a=y({data:[],links:[],from:0,to:0,total:0,current_page:1,last_page:1,per_page:50}),l=y([]),j=V(()=>a.value.data.length===0?!1:a.value.data.every(o=>l.value.includes(o.id))),N=V(()=>{const o=a.value.data.filter(e=>l.value.includes(e.id));return o.length>0&&o.length<a.value.data.length}),p=y(""),F=y(0),C=y(!1),B=y(!1),D=y(!0),n=I({package_id:w.packageId,start_date:"",end_date:"",room_type_id:""}),d=I({id:null,start_date:"",end_date:""}),x=async(o=1)=>{try{const e=await M.get(route("date-blockers.index"),{params:{package_id:w.packageId,page:o}});a.value=e.data,D.value=!1}catch(e){console.error("Error fetching date blockers:",e),D.value=!1}},R=async o=>{try{await x(o),F.value++}catch(e){console.error("Error changing page:",e)}},z=()=>{n.post(route("date-blockers.store"),{preserveScroll:!0,onSuccess:()=>{E(),x(a.value.current_page),g.fire({title:"Success!",text:n.recentlySuccessful?"Date blocker added successfully.":"Operation successful.",icon:"success",confirmButtonColor:"#4F46E5"})},onError:o=>{o.room_type_id?p.value=Array.isArray(o.room_type_id)?o.room_type_id.join(", "):o.room_type_id:o.date_range?p.value=Array.isArray(o.date_range)?o.date_range.join(", "):o.date_range:o.start_date?p.value=Array.isArray(o.start_date)?o.start_date.join(", "):o.start_date:o.end_date?p.value=Array.isArray(o.end_date)?o.end_date.join(", "):o.end_date:o.error?p.value=Array.isArray(o.error)?o.error.join(", "):o.error:p.value="An unexpected error occurred. Please try again."}})},K=()=>{d.put(route("date-blockers.update",d.id),{preserveScroll:!0,onSuccess:()=>{A(),x(a.value.current_page),g.fire({title:"Success!",text:d.recentlySuccessful?"Date blocker updated successfully.":"Operation successful.",icon:"success",confirmButtonColor:"#4F46E5"})},onError:o=>{o.date_range?g.fire({title:"Error!",text:o.date_range,icon:"error",confirmButtonColor:"#4F46E5"}):o.error&&g.fire({title:"Error!",text:o.error,icon:"error",confirmButtonColor:"#4F46E5"})}})},H=async o=>{var r,c,v,T;if((await g.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#e3342f",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await M.delete(route("date-blockers.destroy",o)),a.value.data.length===1&&a.value.current_page>1?await x(a.value.current_page-1):await x(a.value.current_page),g.fire({title:"Deleted!",text:"Date blocker has been deleted.",icon:"success",confirmButtonColor:"#4F46E5"})}catch(q){const X=((c=(r=q.response)==null?void 0:r.data)==null?void 0:c.message)||((T=(v=q.response)==null?void 0:v.data)==null?void 0:T.error)||"Error deleting date blocker";g.fire({title:"Error!",text:X,icon:"error",confirmButtonColor:"#4F46E5"})}},G=()=>{if(j.value){const o=a.value.data.map(e=>e.id);l.value=l.value.filter(e=>!o.includes(e))}else{const o=a.value.data.map(e=>e.id);l.value=[...new Set([...l.value,...o])]}},J=o=>{const e=l.value.indexOf(o);e>-1?l.value.splice(e,1):l.value.push(o)},Q=async()=>{var e,r;if(l.value.length===0)return;if((await g.fire({title:"Are you sure?",text:`You are about to delete ${l.value.length} date blocker(s). This action cannot be undone!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#e3342f",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete them!",showConfirmButton:!0,showCloseButton:!0})).isConfirmed)try{const c=await M.delete(route("date-blockers.destroy-bulk"),{data:{ids:l.value,package_id:w.packageId}});g.fire({title:"Deleted!",text:c.data.message,icon:"success",confirmButtonText:"OK",confirmButtonColor:"#4F46E5"}),l.value=[],await x(1)}catch(c){g.fire({title:"Error!",text:((r=(e=c.response)==null?void 0:e.data)==null?void 0:r.message)||"Failed to delete date blockers",icon:"error",confirmButtonColor:"#4F46E5"})}},W=o=>{d.id=o.id,d.start_date=h(o.start_date).format("YYYY-MM-DD"),d.end_date=h(o.end_date).format("YYYY-MM-DD"),B.value=!0},E=()=>{C.value=!1,n.reset(),n.clearErrors(),p.value=""},A=()=>{B.value=!1,d.reset(),d.clearErrors()};return Z(()=>{x()}),(o,e)=>(i(),u("div",de,[t("div",ne,[t("div",le,[e[8]||(e[8]=t("h3",{class:"text-md font-medium text-gray-900"},"Date Blockers",-1)),l.value.length>0?(i(),u("button",{key:0,onClick:Q,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 text-xs flex items-center space-x-2"},[e[7]||(e[7]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),t("span",null,"Delete Selected ("+m(l.value.length)+")",1)])):f("",!0)]),t("button",{onClick:e[0]||(e[0]=r=>C.value=!0),class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-xs"}," Add Date Blocker ")]),t("div",ie,[D.value?(i(),u("div",ue,[S(se)])):(i(),u("table",ce,[t("thead",pe,[t("tr",null,[t("th",me,[t("input",{type:"checkbox",checked:j.value,indeterminate:N.value,onChange:G,class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"},null,40,ge)]),e[9]||(e[9]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Start Date ",-1)),e[10]||(e[10]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," End Date ",-1)),e[11]||(e[11]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Room Type ",-1)),e[12]||(e[12]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ",-1))])]),t("tbody",fe,[(i(!0),u(P,null,U(a.value.data,r=>{var c;return i(),u("tr",{key:r.id},[t("td",xe,[t("input",{type:"checkbox",checked:l.value.includes(r.id),onChange:v=>J(r.id),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"},null,40,ye)]),t("td",ve,m(s(h)(r.start_date).format("DD/MM/YYYY")),1),t("td",_e,m(s(h)(r.end_date).format("DD/MM/YYYY")),1),t("td",be,m((c=r.room_type)==null?void 0:c.name),1),t("td",ke,[t("button",{onClick:v=>W(r),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Edit ",8,he),t("button",{onClick:v=>H(r.id),class:"text-red-600 hover:text-red-900"}," Delete ",8,we)])])}),128)),a.value.data.length===0?(i(),u("tr",Ce,e[13]||(e[13]=[t("td",{colspan:"5",class:"text-center text-gray-500 py-4 border-t border-b border-gray-300"}," No date blockers found ",-1)]))):f("",!0)])]))]),t("div",Be,[a.value.data.length>0?(i(),ee(re,{links:a.value.links,from:a.value.from,to:a.value.to,total:a.value.total,"component-loading":!0,onPageChange:R,key:F.value},null,8,["links","from","to","total"])):f("",!0)]),S(L,{show:C.value,onClose:E},{default:O(()=>[t("div",De,[e[20]||(e[20]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Add Date Blocker",-1)),p.value?(i(),u("div",Ee,[t("button",{onClick:e[1]||(e[1]=r=>p.value=""),class:"absolute top-2 right-2 text-red-700 hover:text-red-900"},e[14]||(e[14]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),te(" "+m(p.value),1)])):f("",!0),t("form",{onSubmit:$(z,["prevent"])},[t("div",Ae,[t("div",null,[e[15]||(e[15]=t("label",{for:"start_date",class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),_(t("input",{type:"date",id:"start_date","onUpdate:modelValue":e[2]||(e[2]=r=>s(n).start_date=r),class:b(["mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",{"border-red-500":s(n).errors.start_date}]),required:""},null,2),[[k,s(n).start_date]]),s(n).errors.start_date?(i(),u("div",Se,m(s(n).errors.start_date),1)):f("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{for:"end_date",class:"block text-sm font-medium text-gray-700"},"End Date",-1)),_(t("input",{type:"date",id:"end_date","onUpdate:modelValue":e[3]||(e[3]=r=>s(n).end_date=r),class:b(["mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",{"border-red-500":s(n).errors.end_date}]),required:""},null,2),[[k,s(n).end_date]]),s(n).errors.end_date?(i(),u("div",Me,m(s(n).errors.end_date),1)):f("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{for:"room_type_id",class:"block text-sm font-medium text-gray-700"},"Room Type",-1)),_(t("select",{id:"room_type_id","onUpdate:modelValue":e[4]||(e[4]=r=>s(n).room_type_id=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[e[17]||(e[17]=t("option",{value:""},"Select Room Type",-1)),e[18]||(e[18]=t("option",{value:"all"},"All Room Types",-1)),(i(!0),u(P,null,U(Y.packageUniqueRoomTypes,(r,c)=>(i(),u("option",{value:c,key:c},m(r),9,Ye))),128))],512),[[oe,s(n).room_type_id]])])]),t("div",je,[t("button",{type:"button",onClick:E,class:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 text-xs"}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-xs",disabled:s(n).processing}," Add Date Blocker ",8,Fe)])],32)])]),_:1},8,["show"]),S(L,{show:B.value,onClose:A},{default:O(()=>[t("div",Te,[e[23]||(e[23]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Edit Date Blocker",-1)),t("form",{onSubmit:$(K,["prevent"])},[t("div",qe,[t("div",null,[e[21]||(e[21]=t("label",{for:"edit_start_date",class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),_(t("input",{type:"date",id:"edit_start_date","onUpdate:modelValue":e[5]||(e[5]=r=>s(d).start_date=r),class:b(["mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",{"border-red-500":s(d).errors.start_date}]),required:""},null,2),[[k,s(d).start_date]]),s(d).errors.start_date?(i(),u("div",Ve,m(s(d).errors.start_date),1)):f("",!0)]),t("div",null,[e[22]||(e[22]=t("label",{for:"edit_end_date",class:"block text-sm font-medium text-gray-700"},"End Date",-1)),_(t("input",{type:"date",id:"edit_end_date","onUpdate:modelValue":e[6]||(e[6]=r=>s(d).end_date=r),class:b(["mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",{"border-red-500":s(d).errors.end_date}]),required:""},null,2),[[k,s(d).end_date]]),s(d).errors.end_date?(i(),u("div",Ie,m(s(d).errors.end_date),1)):f("",!0)])]),t("div",Pe,[t("button",{type:"button",onClick:A,class:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 text-xs"}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-xs",disabled:s(d).processing}," Update Date Blocker ",8,Ue)])],32)])]),_:1},8,["show"])]))}},Ge=ae(Oe,[["__scopeId","data-v-6ed40148"]]);export{Ge as default};
