import{r as f,i as T,C as Y,k as Z,g as u,o as i,b as t,a as B,h as v,t as x,F as I,y as q,c as ee,w as P,f as te,e as V,j as D,n as O,u as n,q as $,x as oe,z as E}from"./app-CqiO_9lY.js";import{_ as L}from"./Modal.vue_vue_type_script_setup_true_lang-DtPh_t5B.js";import{P as se}from"./Pagination-DDYpFfDe.js";import{h as N}from"./moment-C5S46NFB.js";import{S as g}from"./sweetalert2.esm.all-B0Dix5B2.js";import{L as ae}from"./LoadingComponent-CSTu6URl.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"space-y-6"},ne={class:"flex justify-between items-center"},le={class:"flex items-center space-x-4"},ie={class:"overflow-x-auto"},ce={key:0,class:"flex justify-center items-center h-full min-h-[400px]"},ue={key:1,class:"min-w-full divide-y divide-gray-200"},pe={class:"bg-gray-50"},ge={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12"},me=["checked","indeterminate"],fe={class:"bg-white divide-y divide-gray-200"},xe={class:"px-6 py-4 whitespace-nowrap"},ve=["checked","onChange"],ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},be={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},he=["onClick"],ke=["onClick"],we={key:0},Ce={class:"mt-4"},Be={class:"p-6"},De={key:0,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded relative"},Ee={class:"grid grid-cols-1 gap-6"},Ae={key:0,class:"mt-1 text-sm text-red-600"},Se=["value"],Me={class:"mt-6 flex justify-end space-x-3"},je=["disabled"],Fe={class:"p-6"},Te={class:"grid grid-cols-1 gap-6"},Ye={key:0,class:"mt-1 text-sm text-red-600"},Ie={class:"mt-6 flex justify-end space-x-3"},qe=["disabled"],Pe={__name:"DateBlockers",props:{packageId:{type:Number,required:!0},package:{type:Object,required:!0},packageUniqueRoomTypes:{type:Object,required:!0}},setup(A){const _=A,a=f({data:[],links:[],from:0,to:0,total:0,current_page:1,last_page:1,per_page:50}),r=f([]),S=T(()=>a.value.data.length===0?!1:a.value.data.every(o=>r.value.includes(o.id))),R=T(()=>{const o=a.value.data.filter(e=>r.value.includes(e.id));return o.length>0&&o.length<a.value.data.length}),p=f(""),M=f(0),b=f(!1),h=f(!1),k=f(!0),l=Y({package_id:_.packageId,start_date:"",end_date:"",room_type_id:""}),d=Y({id:null,start_date:"",end_date:""}),m=async(o=1)=>{try{const e=await E.get(route("date-blockers.index"),{params:{package_id:_.packageId,page:o}});a.value=e.data,k.value=!1}catch(e){console.error("Error fetching date blockers:",e),k.value=!1}},U=async o=>{try{await m(o),M.value++}catch(e){console.error("Error changing page:",e)}},z=()=>{l.end_date=l.start_date,l.post(route("date-blockers.store"),{preserveScroll:!0,onSuccess:()=>{w(),m(a.value.current_page),g.fire({title:"Success!",text:l.recentlySuccessful?"Date blocker added successfully.":"Operation successful.",icon:"success",confirmButtonColor:"#4F46E5"})},onError:o=>{o.room_type_id?p.value=Array.isArray(o.room_type_id)?o.room_type_id.join(", "):o.room_type_id:o.date_range?p.value=Array.isArray(o.date_range)?o.date_range.join(", "):o.date_range:o.start_date?p.value=Array.isArray(o.start_date)?o.start_date.join(", "):o.start_date:o.end_date?p.value=Array.isArray(o.end_date)?o.end_date.join(", "):o.end_date:o.error?p.value=Array.isArray(o.error)?o.error.join(", "):o.error:p.value="An unexpected error occurred. Please try again."}})},K=()=>{d.end_date=d.start_date,d.put(route("date-blockers.update",d.id),{preserveScroll:!0,onSuccess:()=>{C(),m(a.value.current_page),g.fire({title:"Success!",text:d.recentlySuccessful?"Date blocker updated successfully.":"Operation successful.",icon:"success",confirmButtonColor:"#4F46E5"})},onError:o=>{o.date_range?g.fire({title:"Error!",text:o.date_range,icon:"error",confirmButtonColor:"#4F46E5"}):o.error&&g.fire({title:"Error!",text:o.error,icon:"error",confirmButtonColor:"#4F46E5"})}})},H=async o=>{var s,c,y,j;if((await g.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#e3342f",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await E.delete(route("date-blockers.destroy",o)),a.value.data.length===1&&a.value.current_page>1?await m(a.value.current_page-1):await m(a.value.current_page),g.fire({title:"Deleted!",text:"Date blocker has been deleted.",icon:"success",confirmButtonColor:"#4F46E5"})}catch(F){const X=((c=(s=F.response)==null?void 0:s.data)==null?void 0:c.message)||((j=(y=F.response)==null?void 0:y.data)==null?void 0:j.error)||"Error deleting date blocker";g.fire({title:"Error!",text:X,icon:"error",confirmButtonColor:"#4F46E5"})}},G=()=>{if(S.value){const o=a.value.data.map(e=>e.id);r.value=r.value.filter(e=>!o.includes(e))}else{const o=a.value.data.map(e=>e.id);r.value=[...new Set([...r.value,...o])]}},J=o=>{const e=r.value.indexOf(o);e>-1?r.value.splice(e,1):r.value.push(o)},Q=async()=>{var e,s;if(r.value.length===0)return;if((await g.fire({title:"Are you sure?",text:`You are about to delete ${r.value.length} date blocker(s). This action cannot be undone!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#e3342f",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete them!",showConfirmButton:!0,showCloseButton:!0})).isConfirmed)try{const c=await E.delete(route("date-blockers.destroy-bulk"),{data:{ids:r.value,package_id:_.packageId}});g.fire({title:"Deleted!",text:c.data.message,icon:"success",confirmButtonText:"OK",confirmButtonColor:"#4F46E5"}),r.value=[],await m(1)}catch(c){g.fire({title:"Error!",text:((s=(e=c.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to delete date blockers",icon:"error",confirmButtonColor:"#4F46E5"})}},W=o=>{d.id=o.id,d.start_date=N(o.start_date).format("YYYY-MM-DD"),h.value=!0},w=()=>{b.value=!1,l.reset(),l.clearErrors(),p.value=""},C=()=>{h.value=!1,d.reset(),d.clearErrors()};return Z(()=>{m()}),(o,e)=>(i(),u("div",de,[t("div",ne,[t("div",le,[e[6]||(e[6]=t("h3",{class:"text-md font-medium text-gray-900"},"Date Blockers",-1)),r.value.length>0?(i(),u("button",{key:0,onClick:Q,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 text-xs flex items-center space-x-2"},[e[5]||(e[5]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),t("span",null,"Delete Selected ("+x(r.value.length)+")",1)])):v("",!0)]),t("button",{onClick:e[0]||(e[0]=s=>b.value=!0),class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-xs"}," Add Date Blocker ")]),t("div",ie,[k.value?(i(),u("div",ce,[B(ae)])):(i(),u("table",ue,[t("thead",pe,[t("tr",null,[t("th",ge,[t("input",{type:"checkbox",checked:S.value,indeterminate:R.value,onChange:G,class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"},null,40,me)]),e[7]||(e[7]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date ",-1)),e[8]||(e[8]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Room Type ",-1)),e[9]||(e[9]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ",-1))])]),t("tbody",fe,[(i(!0),u(I,null,q(a.value.data,s=>{var c;return i(),u("tr",{key:s.id},[t("td",xe,[t("input",{type:"checkbox",checked:r.value.includes(s.id),onChange:y=>J(s.id),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"},null,40,ve)]),t("td",ye,x(n(N)(s.start_date).format("DD/MM/YYYY")),1),t("td",_e,x((c=s.room_type)==null?void 0:c.name),1),t("td",be,[t("button",{onClick:y=>W(s),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Edit ",8,he),t("button",{onClick:y=>H(s.id),class:"text-red-600 hover:text-red-900"}," Delete ",8,ke)])])}),128)),a.value.data.length===0?(i(),u("tr",we,e[10]||(e[10]=[t("td",{colspan:"4",class:"text-center text-gray-500 py-4 border-t border-b border-gray-300"}," No date blockers found ",-1)]))):v("",!0)])]))]),t("div",Ce,[a.value.data.length>0?(i(),ee(se,{links:a.value.links,from:a.value.from,to:a.value.to,total:a.value.total,"component-loading":!0,onPageChange:U,key:M.value},null,8,["links","from","to","total"])):v("",!0)]),B(L,{show:b.value,onClose:w},{default:P(()=>[t("div",Be,[e[16]||(e[16]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Add Date Blocker",-1)),p.value?(i(),u("div",De,[t("button",{onClick:e[1]||(e[1]=s=>p.value=""),class:"absolute top-2 right-2 text-red-700 hover:text-red-900"},e[11]||(e[11]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),te(" "+x(p.value),1)])):v("",!0),t("form",{onSubmit:V(z,["prevent"])},[t("div",Ee,[t("div",null,[e[12]||(e[12]=t("label",{for:"start_date",class:"block text-sm font-medium text-gray-700"},"Date",-1)),D(t("input",{type:"date",id:"start_date","onUpdate:modelValue":e[2]||(e[2]=s=>n(l).start_date=s),class:O(["mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",{"border-red-500":n(l).errors.start_date}]),required:""},null,2),[[$,n(l).start_date]]),n(l).errors.start_date?(i(),u("div",Ae,x(n(l).errors.start_date),1)):v("",!0)]),t("div",null,[e[15]||(e[15]=t("label",{for:"room_type_id",class:"block text-sm font-medium text-gray-700"},"Room Type",-1)),D(t("select",{id:"room_type_id","onUpdate:modelValue":e[3]||(e[3]=s=>n(l).room_type_id=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[e[13]||(e[13]=t("option",{value:""},"Select Room Type",-1)),e[14]||(e[14]=t("option",{value:"all"},"All Room Types",-1)),(i(!0),u(I,null,q(A.packageUniqueRoomTypes,(s,c)=>(i(),u("option",{value:c,key:c},x(s),9,Se))),128))],512),[[oe,n(l).room_type_id]])])]),t("div",Me,[t("button",{type:"button",onClick:w,class:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 text-xs"}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-xs",disabled:n(l).processing}," Add Date Blocker ",8,je)])],32)])]),_:1},8,["show"]),B(L,{show:h.value,onClose:C},{default:P(()=>[t("div",Fe,[e[18]||(e[18]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"Edit Date Blocker",-1)),t("form",{onSubmit:V(K,["prevent"])},[t("div",Te,[t("div",null,[e[17]||(e[17]=t("label",{for:"edit_start_date",class:"block text-sm font-medium text-gray-700"},"Date",-1)),D(t("input",{type:"date",id:"edit_start_date","onUpdate:modelValue":e[4]||(e[4]=s=>n(d).start_date=s),class:O(["mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",{"border-red-500":n(d).errors.start_date}]),required:""},null,2),[[$,n(d).start_date]]),n(d).errors.start_date?(i(),u("div",Ye,x(n(d).errors.start_date),1)):v("",!0)])]),t("div",Ie,[t("button",{type:"button",onClick:C,class:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 text-xs"}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-xs",disabled:n(d).processing}," Update Date Blocker ",8,qe)])],32)])]),_:1},8,["show"])]))}},ze=re(Pe,[["__scopeId","data-v-4ec4e0d5"]]);export{ze as default};
