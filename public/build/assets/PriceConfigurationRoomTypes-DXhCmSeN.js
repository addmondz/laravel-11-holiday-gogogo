import{a as R,l as _,i as K,g as o,o as r,b as a,h as N,j as C,q as j,F as f,s as h,y as L,t as m,n as U,k as B,u as ee,f as te}from"./app-DszDN3Wf.js";import{S as T}from"./sweetalert2.esm.all-B0Dix5B2.js";import{L as se}from"./LoadingComponent-B_uVTLea.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{I as ne}from"./AntdIcon-D1M0HTdX.js";var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"}}]},name:"copy",theme:"outlined"};function z(c){for(var u=1;u<arguments.length;u++){var d=arguments[u]!=null?Object(arguments[u]):{},y=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(y=y.concat(Object.getOwnPropertySymbols(d).filter(function(v){return Object.getOwnPropertyDescriptor(d,v).enumerable}))),y.forEach(function(v){re(c,v,d[v])})}return c}function re(c,u,d){return u in c?Object.defineProperty(c,u,{value:d,enumerable:!0,configurable:!0,writable:!0}):c[u]=d,c}var $=function(u,d){var y=z({},u,d.attrs);return R(ne,z({},y,{icon:oe}),null)};$.displayName="CopyOutlined";$.inheritAttrs=!1;const ie={class:"space-y-6"},le={class:"bg-white shadow rounded-lg p-6"},de={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ce=["value"],ue=["value"],pe=["value"],ye={class:"mt-6 flex gap-2"},fe=["disabled"],me={key:0},ge={key:1},ve={key:0,class:"bg-white shadow rounded-lg p-6"},_e={key:0,class:"flex items-center justify-center min-h-[300px]"},he={key:1,class:"text-center text-gray-500"},be={key:2,class:"space-y-10"},xe={class:"flex items-center justify-between"},ke={class:"space-x-2"},Ce=["disabled"],Se={key:0},Te={key:1,class:"px-3 py-2"},Ae=["data-package-config-id"],Oe={class:"flex items-center justify-between"},Pe={class:"font-medium text-gray-900"},Ve={style:{"margin-top":"10px"}},Ne={class:"overflow-x-auto border rounded-lg"},je={class:"min-w-full text-sm"},Re={class:"bg-gray-200"},$e=["colspan"],Ie={class:"px-4 py-2 align-middle whitespace-nowrap font-medium text-gray-800"},qe={class:"flex flex-col items-start justify-start w-32"},Me={class:"text-xs text-gray-600"},De={key:0,class:"flex items-center rounded-md shadow-sm border border-gray-300 focus-within:ring-2 focus-within:ring-indigo-500"},Ee=["onUpdate:modelValue"],Le=["onClick"],Ue={key:1,class:"mt-1 font-medium"},Be={key:0,style:{"margin-top":"15px"}},ze={class:"overflow-x-auto border rounded-lg"},Fe={class:"min-w-full text-sm"},He={class:"bg-gray-200"},Ye={class:"px-4 py-3 font-medium text-gray-800 whitespace-nowrap"},Je=["onUpdate:modelValue"],We={__name:"PriceConfigurationRoomTypes",props:{packageId:{type:Number,required:!0},seasonTypes:{type:Array,required:!0},dateTypes:{type:Array,required:!0},packageUniqueRoomTypes:{type:Object,required:!0},allSeasonTypes:{type:Array,required:!0},allDateTypes:{type:Array,required:!0},assignedSeasonTypes:{type:Array,required:!0},assignedDateTypes:{type:Array,required:!0}},setup(c){const u=c,d=_(""),y=_(""),v=_(""),k=_(!1),A=_(!1),b=_(!1),S=_(!1),x=_([]),I=_({}),F=K(()=>!!d.value&&!!y.value),q=n=>Number(n??0).toFixed(2),H=/^(\d+)_a_(\d+)_c_(\d+)_i$/,O=n=>{var e;const s=(e=n==null?void 0:n.match)==null?void 0:e.call(n,H);return s?{a:+s[1],c:+s[2],i:+s[3]}:null},M=n=>{const s=O(n);if(!s)return n||"";const e=(t,i,p)=>`${t} ${t===1?i:p||i+"s"}`;return`${e(s.a,"Adult")} + ${e(s.c,"Child","Children")} + ${e(s.i,"Infant")}`},Y=n=>[...n].sort((s,e)=>{const t=O(s)||{a:0,c:0,i:0},i=O(e)||{a:0,c:0,i:0};return t.a!==i.a?i.a-t.a:t.c!==i.c?i.c-t.c:i.i-t.i}),D=n=>{const s=Object.keys(n||{});return Y(s).map(t=>[t,n[t]])},J=n=>n==="a"||n==="c"||n==="i",E=n=>{const s=Object.keys(n??{}),e=t=>{const i=t[0],l=!J(t)?parseInt(t.slice(1),10)||0:-1;return({a:1,c:2,i:3}[i]||9)*100+l};return s.sort((t,i)=>e(t)-e(i))},W=n=>{if(!n)return"";const s=n[0],e=n.slice(1);return s==="a"?`Adult ${e}`:s==="c"?`Child ${e}`:s==="i"?`Infant ${e}`:n},G=(n,s,e)=>{var g;if(!n||!s||!e)return;const t=(g=n.base)==null?void 0:g[s];if(!t)return;const i=t[e];if(i==null||i==="")return;const p=String(e)[0];let l=0;Object.keys(t).forEach(V=>{V.startsWith(p)&&(t[V]=Number(i),l++)});try{T.fire({toast:!0,timer:1200,showConfirmButton:!1,icon:"success",title:`Copied to ${l} ${p==="a"?"Adult":p==="c"?"Child":"Infant"} slot(s)`})}catch{}},Q=n=>n==="a"?"Adult (per pax)":n==="c"?"Child (per pax)":"Infant (per pax)",P=()=>{k.value=!0,A.value=!0,b.value=!1,L.post(route("configuration-prices.fetchPricesRoomTypes"),{package_id:u.packageId,season_type_id:d.value,date_type_id:y.value,room_type_id:v.value||void 0}).then(n=>{let s=n==null?void 0:n.data;if(typeof s=="string"){const e=s.replace(/,\s*(?=[}\]])/g,"");try{s=JSON.parse(e)}catch(t){console.error("Failed to parse API string after sanitizing:",t),s=[]}}s=Array.isArray(s)?s:[],I.value=s.reduce((e,t)=>{var l,g;const i=(t==null?void 0:t.room_type_id)??((l=t==null?void 0:t.room_type)==null?void 0:l.id),p=(g=t==null?void 0:t.room_type)==null?void 0:g.name;return i&&p&&(e[i]=p),e},{}),x.value=s.map(e=>{var i;const t=Array.isArray(e==null?void 0:e.prices)&&e.prices.length?e.prices[0]:null;return{room_type_id:(e==null?void 0:e.room_type_id)??((i=e==null?void 0:e.room_type)==null?void 0:i.id)??0,room_type_capacity:(e==null?void 0:e.room_type_capacity)??0,room_type_name:(e==null?void 0:e.room_type_name)??"",id:(e==null?void 0:e.id)??0,base:(t==null?void 0:t.base)??{},surch:(t==null?void 0:t.surch)??{}}})}).catch(n=>{console.error(n),T.fire({icon:"error",title:"Error",text:"Failed to fetch price configurations"}),x.value=[]}).finally(()=>{k.value=!1})},X=()=>{d.value="",y.value="",v.value="",x.value=[],I.value={},A.value=!1,b.value=!1},Z=()=>{b.value=!1,P()},w=()=>{S.value=!0;const n=x.value.map(e=>({package_configuration_id:Number(e.id)||null,room_type_id:Number(e.room_type_id)||null,base:e.base??{},surch:e.surch??{}})),s={package_id:u.packageId,season_type_id:d.value,date_type_id:y.value,rooms:n};L.put(route("configuration-prices.updateRoomTypePrices"),s).then(()=>{b.value=!1,T.fire({icon:"success",title:"Saved",timer:1200,showConfirmButton:!1}),P()}).catch(e=>{var t,i;console.error(e),T.fire({icon:"error",title:"Error",text:((i=(t=e.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to save"})}).finally(()=>{S.value=!1})};return(n,s)=>(r(),o("div",ie,[a("div",le,[a("div",de,[a("div",null,[s[5]||(s[5]=a("label",{class:"block text-sm font-medium text-gray-700"},"Season",-1)),C(a("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>d.value=e),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[s[4]||(s[4]=a("option",{value:""},"Select Season",-1)),(r(!0),o(f,null,h(c.assignedSeasonTypes,e=>(r(),o("option",{key:e.id,value:e.id},m(e.name),9,ce))),128))],512),[[j,d.value]])]),a("div",null,[s[7]||(s[7]=a("label",{class:"block text-sm font-medium text-gray-700"},"Date Type",-1)),C(a("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>y.value=e),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[s[6]||(s[6]=a("option",{value:""},"Select Date Type",-1)),(r(!0),o(f,null,h(c.assignedDateTypes,e=>(r(),o("option",{key:e.id,value:e.id},m(e.name),9,ue))),128))],512),[[j,y.value]])]),a("div",null,[s[9]||(s[9]=a("label",{class:"block text-sm font-medium text-gray-700"},"Room Type (Optional)",-1)),C(a("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>v.value=e),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[s[8]||(s[8]=a("option",{value:""},"All Room Types",-1)),(r(!0),o(f,null,h(c.packageUniqueRoomTypes,(e,t)=>(r(),o("option",{key:t,value:t},m(e),9,pe))),128))],512),[[j,v.value]])])]),a("div",ye,[a("button",{onClick:P,disabled:!F.value||k.value,class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-xs disabled:opacity-50 disabled:cursor-not-allowed"},[k.value?(r(),o("span",me,"Loading...")):(r(),o("span",ge,"Search Prices"))],8,fe),a("button",{onClick:X,class:"px-6 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 text-xs"}," Reset ")])]),A.value?(r(),o("div",ve,[k.value?(r(),o("div",_e,[R(se)])):x.value.length?(r(),o("div",be,[a("div",xe,[s[10]||(s[10]=a("div",null,[a("h2",{class:"text-lg font-semibold"},"Price Matrix"),a("p",{class:"text-xs text-gray-500"}," Base charge applies to each slot (Adult 1, Adult 2, Child 1, …). Surcharge applies per person (Adult / Child / Infant). ")],-1)),a("div",ke,[b.value?(r(),o(f,{key:1},[a("button",{onClick:Z,class:"px-3 py-2 rounded bg-gray-100 text-gray-700 text-sm"}," Cancel "),a("button",{onClick:w,class:"px-3 py-2 rounded bg-indigo-600 text-white text-sm",disabled:S.value},[S.value?(r(),o("span",Se,"Saving...")):(r(),o("span",Te,"Save"))],8,Ce)],64)):(r(),o("button",{key:0,onClick:s[3]||(s[3]=e=>b.value=!0),class:"px-5 py-2 rounded bg-indigo-600 text-white text-sm"}," Edit All Prices "))])]),(r(!0),o(f,null,h(x.value,e=>(r(),o("div",{key:e.room_type_id,class:"space-y-8","data-package-config-id":e.id},[a("div",Oe,[a("h3",Pe,m(e.room_type_name)+" ( "+m(e.room_type_capacity)+" pax ) ",1)]),a("section",Ve,[a("div",Ne,[a("table",je,[a("thead",Re,[a("tr",null,[a("th",{class:"px-4 py-2 text-left",colspan:E(e.base).length}," Base Charge ",8,$e)])]),a("tbody",null,[(r(!0),o(f,null,h(D(e.base),([t,i],p)=>(r(),o("tr",{key:t,class:U(p%2?"bg-white":"bg-gray-50")},[a("td",Ie,m(M(t)),1),(r(!0),o(f,null,h(E(i),l=>(r(),o("td",{class:"px-4 py-2",key:l},[a("div",qe,[a("span",Me,m(W(l)),1),b.value?(r(),o("div",De,[C(a("input",{type:"number",step:"0.01",class:"w-full rounded-l-md border-none focus:ring-0 px-3 py-2","onUpdate:modelValue":g=>e.base[t][l]=g},null,8,Ee),[[B,e.base[t][l],void 0,{number:!0}]]),a("button",{type:"button",class:"flex items-center justify-center px-3 border-l border-gray-300 text-gray-500 hover:text-indigo-600 hover:bg-gray-50 rounded-r-md",title:"Copy this pax type's value across this row",onClick:g=>G(e,t,l)},[R(ee($),{class:"h-5 w-5"})],8,Le)])):(r(),o("span",Ue,"MYR "+m(q(e.base[t][l])),1))])]))),128))],2))),128))])])])]),e.surch&&Object.keys(e.surch||{}).length?(r(),o("section",Be,[a("div",ze,[a("table",Fe,[a("thead",He,[a("tr",null,[s[11]||(s[11]=a("th",{class:"px-4 py-2 text-left"},"Surcharge",-1)),(r(),o(f,null,h(["a","c","i"],t=>a("th",{key:t,class:"px-4 py-2 text-left"},m(Q(t)),1)),64))])]),a("tbody",null,[(r(!0),o(f,null,h(D(e.surch),([t,i],p)=>(r(),o("tr",{key:t,class:U(p%2?"bg-white":"bg-gray-50")},[a("td",Ye,m(M(t)),1),(r(),o(f,null,h(["a","c","i"],l=>a("td",{key:l,class:"px-4 py-2"},[i[l]!==void 0?(r(),o(f,{key:0},[b.value?C((r(),o("input",{key:0,type:"number",step:"0.01",class:"w-24 rounded-md border-gray-300 focus:ring-indigo-500 focus:border-indigo-500","onUpdate:modelValue":g=>e.surch[t][l]=g},null,8,Je)),[[B,e.surch[t][l],void 0,{number:!0}]]):(r(),o(f,{key:1},[te(" MYR "+m(q(i[l])),1)],64))],64)):N("",!0)])),64))],2))),128))])])])])):N("",!0)],8,Ae))),128))])):(r(),o("div",he," No price configurations found for the selected filters. "))])):N("",!0)]))}},Ke=ae(We,[["__scopeId","data-v-90218453"]]);export{Ke as default};
